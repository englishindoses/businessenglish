<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Business English | Building Professional Relationships</title>
    <link rel="stylesheet" href="css/lessons.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@400;500;600;700&family=Fraunces:wght@600;700&display=swap" rel="stylesheet">
</head>
<body data-lesson="2">
    <header class="header">
        <a href="index.html" class="back-link">‚Üê Back to Course</a>
        <div class="header-content">
            <div class="header-badge">Lesson 2</div>
            <h1>Building Professional Relationships</h1>
            <p class="header-subtitle">Rapport building, starting & ending conversations gracefully</p>
        </div>
        <div class="header-decoration"></div>
    </header>

    <main class="container">
        <!-- Activity 1: Warm-up -->
        <section class="section" id="activity1">
            <div class="section-header">
                <span class="section-number">Warm-up</span>
                <h2>Building Rapport at Work</h2>
            </div>
            <p class="section-intro">Discuss these questions with your teacher.</p>

            <div class="discussion-grid single-column">
                <div class="discussion-card">
                    <div class="card-icon">üí¨</div>
                    <h3>Discussion Questions</h3>
                    <ul class="discussion-questions">
                        <li>Think of a colleague you have good rapport with. What makes the relationship work well?</li>
                        <li>Have you ever been stuck in an awkward conversation at work? How did you handle it?</li>
                        <li>In your culture, how do people typically start and end professional conversations?</li>
                    </ul>
                </div>
            </div>
        </section>

        <!-- Activity 2: Presentation - Key Phrases Sorting -->
        <section class="section" id="activity2">
            <div class="section-header">
                <span class="section-number">Activity 1</span>
                <h2>Key Phrases for Professional Conversations</h2>
            </div>
            <p class="section-intro">Sort these phrases into the correct category. Think about when you would use each phrase.</p>
            
            <div class="sorting-activity">
                <div class="phrase-bank" id="phraseBank">
                    <!-- Starting a Conversation -->
                    <div class="phrase" data-category="starting" draggable="true">Mind if I join you?</div>
                    <div class="phrase" data-category="starting" draggable="true">I don't think we've met. I'm...</div>
                    <div class="phrase" data-category="starting" draggable="true">What brings you to this event?</div>
                    <!-- Building Rapport -->
                    <div class="phrase" data-category="rapport" draggable="true">I remember you mentioned... How's that going?</div>
                    <div class="phrase" data-category="rapport" draggable="true">That must have been challenging!</div>
                    <div class="phrase" data-category="rapport" draggable="true">I know exactly what you mean.</div>
                    <!-- Ending a Conversation -->
                    <div class="phrase" data-category="ending" draggable="true">It's been great chatting. I'd better head off.</div>
                    <div class="phrase" data-category="ending" draggable="true">I won't keep you any longer.</div>
                    <div class="phrase" data-category="ending" draggable="true">Let's catch up again soon.</div>
                    <!-- Escaping Awkward Topics -->
                    <div class="phrase" data-category="escaping" draggable="true">Anyway, how's your project going?</div>
                    <div class="phrase" data-category="escaping" draggable="true">I'd better stay out of that one! So...</div>
                    <div class="phrase" data-category="escaping" draggable="true">That's interesting. Speaking of which...</div>
                </div>
                
                <div class="sorting-zones four-zones">
                    <div class="sort-zone" id="startingZone" data-category="starting">
                        <h4>üöÄ Starting a Conversation</h4>
                        <p class="zone-hint">Breaking the ice</p>
                        <div class="zone-content"></div>
                    </div>
                    <div class="sort-zone" id="rapportZone" data-category="rapport">
                        <h4>ü§ù Building Rapport</h4>
                        <p class="zone-hint">Creating connection</p>
                        <div class="zone-content"></div>
                    </div>
                    <div class="sort-zone" id="endingZone" data-category="ending">
                        <h4>üëã Ending a Conversation</h4>
                        <p class="zone-hint">Leaving gracefully</p>
                        <div class="zone-content"></div>
                    </div>
                    <div class="sort-zone" id="escapingZone" data-category="escaping">
                        <h4>üö™ Escaping Awkward Topics</h4>
                        <p class="zone-hint">Changing direction</p>
                        <div class="zone-content"></div>
                    </div>
                </div>
            </div>
            <button class="check-btn" onclick="checkSorting()">Check Answers</button>
            <button class="reset-btn" onclick="resetSorting()">Reset</button>
            <div class="feedback" id="sortingFeedback"></div>

            <div class="reveal-box" id="phraseTips">
                <div class="reveal-header" onclick="toggleRevealBox(this)">
                    <h4>üìù Tips for Using These Phrases</h4>
                    <span class="reveal-hint">Complete the sorting first, then click to reveal ‚Üí</span>
                </div>
                <div class="reveal-content">
                    <ul>
                        <li><strong>Starting:</strong> Use open questions to invite conversation, not just "yes/no" answers.</li>
                        <li><strong>Rapport:</strong> Show you remember details about them. Reference previous conversations.</li>
                        <li><strong>Ending:</strong> Always give a reason for leaving and end on a positive note.</li>
                        <li><strong>Escaping:</strong> Acknowledge what they said briefly, then pivot with "anyway" or "speaking of which".</li>
                    </ul>
                </div>
            </div>
        </section>

        <!-- Activity 3: Controlled Practice - Matching -->
        <section class="section" id="activity3">
            <div class="section-header">
                <span class="section-number">Activity 2</span>
                <h2>Choosing the Right Response</h2>
            </div>
            <p class="section-intro">Match each situation with the most appropriate response. Drag and drop the responses.</p>

            <div class="drag-match-activity">
                <div class="statements-container">
                    <div class="statement-row" data-match="1">
                        <div class="statement-text">You see someone standing alone at a networking event.</div>
                        <div class="drop-zone" data-match="1">
                            <span class="drop-placeholder">Drop response here</span>
                        </div>
                    </div>
                    <div class="statement-row" data-match="2">
                        <div class="statement-text">A colleague starts complaining about the boss.</div>
                        <div class="drop-zone" data-match="2">
                            <span class="drop-placeholder">Drop response here</span>
                        </div>
                    </div>
                    <div class="statement-row" data-match="3">
                        <div class="statement-text">You've been chatting for 10 minutes and have a meeting to get to.</div>
                        <div class="drop-zone" data-match="3">
                            <span class="drop-placeholder">Drop response here</span>
                        </div>
                    </div>
                    <div class="statement-row" data-match="4">
                        <div class="statement-text">Someone mentions they've just finished a big project.</div>
                        <div class="drop-zone" data-match="4">
                            <span class="drop-placeholder">Drop response here</span>
                        </div>
                    </div>
                    <div class="statement-row" data-match="5">
                        <div class="statement-text">A client brings up a controversial political topic.</div>
                        <div class="drop-zone" data-match="5">
                            <span class="drop-placeholder">Drop response here</span>
                        </div>
                    </div>
                </div>
                
                <div class="draggable-responses" id="responseBank">
                    <div class="draggable-response" draggable="true" data-match="4">"That must be a relief! How long did it take in the end?"</div>
                    <div class="draggable-response" draggable="true" data-match="2">"That sounds frustrating. Anyway, how's the Henderson project coming along?"</div>
                    <div class="draggable-response" draggable="true" data-match="5">"That's interesting. Speaking of which, how's business been this quarter?"</div>
                    <div class="draggable-response" draggable="true" data-match="1">"Hi, I don't think we've met. I'm [name]. What brings you here today?"</div>
                    <div class="draggable-response" draggable="true" data-match="3">"It's been lovely chatting. I'd better head to my meeting, but let's grab a coffee sometime."</div>
                </div>
            </div>
            <button class="check-btn" onclick="checkDragMatching()">Check Matches</button>
            <button class="reset-btn" onclick="resetDragMatching()">Reset</button>
            <div class="feedback" id="dragMatchingFeedback"></div>

            <div class="discussion-note">
                <h4>ü§î Discussion</h4>
                <p>Which of these situations do you find most challenging? Why?</p>
            </div>
        </section>

        <!-- Activity 4: Controlled Practice - Sentence Ordering -->
        <section class="section" id="activity4">
            <div class="section-header">
                <span class="section-number">Activity 3</span>
                <h2>Building Sentences</h2>
            </div>
            <p class="section-intro">Put the words in the correct order to make useful phrases. Drag the words to rearrange them.</p>

            <div class="sentence-ordering-activity" id="sentenceActivity">
                <!-- Sentence 1 -->
                <div class="sentence-exercise" data-sentence="1">
                    <div class="sentence-context">Starting a conversation:</div>
                    <div class="word-bank" data-correct="Mind if I join you?">
                        <div class="draggable-word" draggable="true">you?</div>
                        <div class="draggable-word" draggable="true">Mind</div>
                        <div class="draggable-word" draggable="true">join</div>
                        <div class="draggable-word" draggable="true">if</div>
                        <div class="draggable-word" draggable="true">I</div>
                    </div>
                </div>

                <!-- Sentence 2 -->
                <div class="sentence-exercise" data-sentence="2">
                    <div class="sentence-context">Building rapport:</div>
                    <div class="word-bank" data-correct="That must have been challenging!">
                        <div class="draggable-word" draggable="true">been</div>
                        <div class="draggable-word" draggable="true">have</div>
                        <div class="draggable-word" draggable="true">That</div>
                        <div class="draggable-word" draggable="true">challenging!</div>
                        <div class="draggable-word" draggable="true">must</div>
                    </div>
                </div>

                <!-- Sentence 3 -->
                <div class="sentence-exercise" data-sentence="3">
                    <div class="sentence-context">Ending a conversation:</div>
                    <div class="word-bank" data-correct="I won't keep you any longer.">
                        <div class="draggable-word" draggable="true">any</div>
                        <div class="draggable-word" draggable="true">I</div>
                        <div class="draggable-word" draggable="true">longer.</div>
                        <div class="draggable-word" draggable="true">keep</div>
                        <div class="draggable-word" draggable="true">won't</div>
                        <div class="draggable-word" draggable="true">you</div>
                    </div>
                </div>

                <!-- Sentence 4 -->
                <div class="sentence-exercise" data-sentence="4">
                    <div class="sentence-context">Escaping an awkward topic:</div>
                    <div class="word-bank" data-correct="Anyway, how's your project going?">
                        <div class="draggable-word" draggable="true">going?</div>
                        <div class="draggable-word" draggable="true">project</div>
                        <div class="draggable-word" draggable="true">Anyway,</div>
                        <div class="draggable-word" draggable="true">your</div>
                        <div class="draggable-word" draggable="true">how's</div>
                    </div>
                </div>

                <!-- Sentence 5 -->
                <div class="sentence-exercise" data-sentence="5">
                    <div class="sentence-context">Building rapport:</div>
                    <div class="word-bank" data-correct="I know exactly what you mean.">
                        <div class="draggable-word" draggable="true">you</div>
                        <div class="draggable-word" draggable="true">what</div>
                        <div class="draggable-word" draggable="true">I</div>
                        <div class="draggable-word" draggable="true">mean.</div>
                        <div class="draggable-word" draggable="true">know</div>
                        <div class="draggable-word" draggable="true">exactly</div>
                    </div>
                </div>
            </div>
            <button class="check-btn" onclick="checkSentenceOrder()">Check Answers</button>
            <button class="reset-btn" onclick="resetSentenceOrder()">Reset</button>
            <div class="feedback" id="sentenceFeedback"></div>
        </section>

        <!-- Activity 5: Guided Production - Conversation Planning -->
        <section class="section" id="activity5">
            <div class="section-header">
                <span class="section-number">Activity 4</span>
                <h2>Plan Your Conversation</h2>
            </div>
            <p class="section-intro">Read the scenario below. Plan what you would say at each stage of the conversation, using phrases from this lesson.</p>

            <div class="scenario-box">
                <div class="scenario-icon-large">üé™</div>
                <h3>The Scenario</h3>
                <p>You're at an industry conference during a coffee break. You recognise someone from a company you'd like to work with in the future. They're standing alone looking at their phone. You have about 3 minutes before the next session starts.</p>
            </div>

            <div class="planning-grid">
                <div class="planning-card">
                    <h4>üöÄ Your Opening Line</h4>
                    <p>How will you start the conversation?</p>
                    <textarea class="notes-input" placeholder="Write your opening line here..."></textarea>
                </div>
                <div class="planning-card">
                    <h4>ü§ù Building Rapport</h4>
                    <p>Write 2 questions or phrases to build connection:</p>
                    <textarea class="notes-input" placeholder="1. &#10;2. "></textarea>
                </div>
                <div class="planning-card">
                    <h4>üëã Your Exit</h4>
                    <p>How will you end the conversation gracefully?</p>
                    <textarea class="notes-input" placeholder="Write your closing line here..."></textarea>
                </div>
            </div>

            <div class="practice-prompt">
                <h4>üí¨ Practice</h4>
                <p>Share your plan with your teacher. They will give you feedback before you move to the role play.</p>
            </div>
        </section>

        <!-- Activity 6: Production - Role Play -->
        <section class="section" id="activity6">
            <div class="section-header">
                <span class="section-number">Activity 5</span>
                <h2>Role Play: Real Situations</h2>
            </div>
            <p class="section-intro">Choose a scenario card and practise a conversation with your teacher. Each scenario has a specific challenge.</p>

            <div class="scenario-cards">
                <div class="scenario-card" onclick="selectScenario(this)">
                    <div class="scenario-icon">üèÉ</div>
                    <h4>The Quick Exit</h4>
                    <p>You're chatting with a colleague in the kitchen, but you have an important call in 2 minutes. They're mid-story about their weekend.</p>
                    <div class="scenario-goals">
                        <span>Challenge:</span> End the conversation politely without seeming rude
                    </div>
                </div>

                <div class="scenario-card" onclick="selectScenario(this)">
                    <div class="scenario-icon">üò¨</div>
                    <h4>The Awkward Topic</h4>
                    <p>At a team lunch, a colleague starts criticising another department. You work closely with that department and don't want to get involved.</p>
                    <div class="scenario-goals">
                        <span>Challenge:</span> Change the topic smoothly without offending them
                    </div>
                </div>

                <div class="scenario-card" onclick="selectScenario(this)">
                    <div class="scenario-icon">üÜï</div>
                    <h4>The New Connection</h4>
                    <p>You're at a client's office for a meeting. While waiting in reception, you notice another visitor who might be from a useful contact company.</p>
                    <div class="scenario-goals">
                        <span>Challenge:</span> Start a conversation, build rapport, and exchange details naturally
                    </div>
                </div>

                <div class="scenario-card" onclick="selectScenario(this)">
                    <div class="scenario-icon">üîÑ</div>
                    <h4>The Follow-up</h4>
                    <p>You meet someone you briefly spoke to at an event 3 months ago. You remember their name and that they were working on an interesting project.</p>
                    <div class="scenario-goals">
                        <span>Challenge:</span> Reconnect and show you remember them
                    </div>
                </div>
            </div>

            <div class="roleplay-tips">
                <h4>üí° Remember to:</h4>
                <ul>
                    <li>Use phrases from the lesson naturally</li>
                    <li>Listen and respond to what your partner says</li>
                    <li>Pay attention to your body language and tone</li>
                    <li>Handle the specific challenge in each scenario</li>
                </ul>
            </div>
        </section>

        <!-- Activity 7: Extra - Conversation Questions -->
        <section class="section" id="activity7">
            <div class="section-header">
                <span class="section-number">Extra Activity</span>
                <h2>Discussion: Cultural Perspectives</h2>
            </div>
            <p class="section-intro">Discuss these questions about building professional relationships across cultures.</p>

            <div class="conversation-questions">
                <div class="question-card">
                    <span class="question-number">1</span>
                    <p>In your experience, how do expectations around small talk differ between cultures? Have you ever misread a situation?</p>
                </div>
                <div class="question-card">
                    <span class="question-number">2</span>
                    <p>Some cultures value getting straight to business; others expect relationship-building first. What's the norm in your industry?</p>
                </div>
                <div class="question-card">
                    <span class="question-number">3</span>
                    <p>How do you build rapport with someone you only interact with virtually? What's different from face-to-face?</p>
                </div>
                <div class="question-card">
                    <span class="question-number">4</span>
                    <p>"It's not what you know, it's who you know." Do you agree? How important is networking in your field?</p>
                </div>
            </div>
        </section>

        <!-- Wrap Up -->
        <section class="section wrap-up" id="wrapup">
            <div class="section-header">
                <span class="section-number">Wrap Up</span>
                <h2>Reflection & Next Steps</h2>
            </div>
            
            <div class="reflection-grid">
                <div class="reflection-card">
                    <h4>üåü Key Phrases to Remember</h4>
                    <p>Which 3 phrases from today will you try to use this week?</p>
                    <textarea class="notes-input" placeholder="1. &#10;2. &#10;3. "></textarea>
                </div>
                <div class="reflection-card">
                    <h4>üìã Real-World Practice</h4>
                    <p>Think of an upcoming situation where you could practise these skills. What will you do differently?</p>
                    <textarea class="notes-input" placeholder="Your notes..."></textarea>
                </div>
            </div>
        </section>

        <!-- Lesson Completion Section -->
        <section class="section lesson-completion" id="completion">
            <div class="completion-content">
                <div class="completion-icon" id="completionIcon">üìö</div>
                <h3 id="completionTitle">You've reached the end of Lesson 2!</h3>
                <p id="completionText">Well done on completing the activities. If you're happy with your progress, mark this lesson as complete to track your journey through the course.</p>
                <div class="completion-buttons">
                    <a href="lesson1.html" class="nav-btn">‚Üê Previous Lesson</a>
                    <button class="complete-lesson-btn" id="completeBtn" onclick="toggleLessonCompletion()">
                        <span class="btn-icon">‚úì</span>
                        <span class="btn-text">Mark as Complete</span>
                    </button>
                    <a href="lesson3.html" class="nav-btn nav-btn-primary">Next Lesson ‚Üí</a>
                </div>
            </div>
        </section>
    </main>

    <footer class="footer">
        <p>Business English Course by English in Doses</p>
    </footer>

    <!-- Load activities.js as ES module -->
    <script type="module" src="js/activities.js"></script>
    <!-- Load sentence ordering as ES module -->
    <script type="module" src="js/sentence-ordering.js"></script>
    
    <!-- Lesson completion functionality -->
    <script type="module">
        import { 
            isLessonComplete, 
            markLessonComplete, 
            markLessonIncomplete,
            getCurrentUser
        } from './js/lesson-utils.js';
        
        const LESSON_NUMBER = parseInt(document.body.dataset.lesson);
        let isComplete = false;
        
        // Initialize on page load
        document.addEventListener('DOMContentLoaded', async function() {
            await initializeCompletion();
        });
        
        async function initializeCompletion() {
            const username = getCurrentUser();
            if (username) {
                isComplete = await isLessonComplete(LESSON_NUMBER);
                updateCompletionUI();
            }
        }
        
        function updateCompletionUI() {
            const icon = document.getElementById('completionIcon');
            const title = document.getElementById('completionTitle');
            const text = document.getElementById('completionText');
            const btn = document.getElementById('completeBtn');
            const section = document.querySelector('.lesson-completion');
            
            if (isComplete) {
                icon.textContent = 'üéâ';
                title.textContent = 'Lesson Complete!';
                text.textContent = 'Fantastic work! You\'ve completed this lesson. Keep up the momentum and continue to the next lesson when you\'re ready.';
                btn.innerHTML = '<span class="btn-icon">‚Ü©</span><span class="btn-text">Mark as Incomplete</span>';
                btn.classList.add('completed');
                section.classList.add('is-complete');
            } else {
                icon.textContent = 'üìö';
                title.textContent = `You've reached the end of Lesson ${LESSON_NUMBER}!`;
                text.textContent = 'Well done on completing the activities. If you\'re happy with your progress, mark this lesson as complete to track your journey through the course.';
                btn.innerHTML = '<span class="btn-icon">‚úì</span><span class="btn-text">Mark as Complete</span>';
                btn.classList.remove('completed');
                section.classList.remove('is-complete');
            }
        }
        
        // Make toggle function globally accessible
        window.toggleLessonCompletion = async function() {
            const btn = document.getElementById('completeBtn');
            const username = getCurrentUser();
            
            if (!username) {
                alert('Please log in on the homepage first to track your progress.');
                return;
            }
            
            // Disable button during operation
            btn.disabled = true;
            btn.style.opacity = '0.7';
            
            try {
                if (isComplete) {
                    await markLessonIncomplete(LESSON_NUMBER);
                    isComplete = false;
                } else {
                    await markLessonComplete(LESSON_NUMBER);
                    isComplete = true;
                }
                
                updateCompletionUI();
                
                // Visual feedback
                btn.style.transform = 'scale(0.95)';
                setTimeout(() => {
                    btn.style.transform = '';
                }, 150);
            } catch (error) {
                console.error('Error toggling completion:', error);
                alert('There was an error saving your progress. Please try again.');
            } finally {
                btn.disabled = false;
                btn.style.opacity = '1';
            }
        };
        
        window.scrollToTop = function(event) {
            event.preventDefault();
            window.scrollTo({
                top: 0,
                behavior: 'smooth'
            });
        };
    </script>
</body>
</html>
