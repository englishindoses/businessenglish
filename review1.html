<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Business English | Review 1</title>
    <link rel="stylesheet" href="css/lessons.css">
    <link rel="stylesheet" href="css/drop-down.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@400;500;600;700&family=Fraunces:wght@600;700&display=swap" rel="stylesheet">
</head>
<body data-lesson="13">
    <header class="header">
        <a href="index.html" class="back-link">‚Üê Back to Course</a>
        <div class="header-content">
            <div class="header-badge">Review 1</div>
            <h1>Consolidation</h1>
            <p class="header-subtitle">Review key grammar and expressions from Lessons 1-3</p>
        </div>
        <div class="header-decoration"></div>
    </header>

    <main class="container">
        <!-- Activity 1: Grammar Review -->
        <section class="section" id="activity1">
            <div class="section-header">
                <span class="section-number">Activity 1/5</span>
                <h2>Grammar Review: Verbs + -ing / to</h2>
            </div>
            <p class="section-intro">Many verbs are followed by another verb. The second verb can be in the <strong>-ing form</strong> or the <strong>to + infinitive form</strong>. Unfortunately, there's no perfect rule ‚Äî you need to learn which verbs take which form. Here are the most common ones:</p>

            <div class="language-box">
                <h4>üìò Verbs followed by -ing</h4>
                <ul>
                    <li><strong>enjoy</strong> ‚Äì I enjoy working with clients.</li>
                    <li><strong>avoid</strong> ‚Äì We avoid making promises we can't keep.</li>
                    <li><strong>finish</strong> ‚Äì Have you finished writing the report?</li>
                    <li><strong>consider</strong> ‚Äì I'm considering changing careers.</li>
                    <li><strong>suggest</strong> ‚Äì She suggested having a meeting.</li>
                    <li><strong>mind</strong> ‚Äì Would you mind waiting?</li>
                    <li><strong>keep</strong> ‚Äì Keep trying!</li>
                    <li><strong>involve</strong> ‚Äì My role involves managing a team.</li>
                </ul>
            </div>

            <div class="language-box" style="margin-top: 1rem;">
                <h4>üìó Verbs followed by to + infinitive</h4>
                <ul>
                    <li><strong>want</strong> ‚Äì I want to discuss the budget.</li>
                    <li><strong>need</strong> ‚Äì We need to hire more staff.</li>
                    <li><strong>decide</strong> ‚Äì She decided to accept the offer.</li>
                    <li><strong>hope</strong> ‚Äì I hope to see you there.</li>
                    <li><strong>plan</strong> ‚Äì We're planning to expand next year.</li>
                    <li><strong>agree</strong> ‚Äì They agreed to work together.</li>
                    <li><strong>tend</strong> ‚Äì I tend to be quite organised.</li>
                    <li><strong>mean</strong> ‚Äì I meant to ask you about that.</li>
                </ul>
            </div>

            <div class="discussion-note" style="margin-top: 1.5rem;">
                <h4>‚ö†Ô∏è Special Case: "Stop"</h4>
                <p><strong>stop + -ing</strong> = quit doing something<br>
                <em>"I stopped smoking."</em> ‚Üí I don't smoke anymore.<br><br>
                <strong>stop + to</strong> = pause in order to do something else<br>
                <em>"I stopped to smoke."</em> ‚Üí I was walking, then I paused to have a cigarette.</p>
            </div>

            <div class="practice-prompt" style="margin-top: 1.5rem;">
                <h4>üí° Tip</h4>
                <p>Many <strong>-ing verbs</strong> describe your feelings or attitudes towards activities (enjoy, avoid, mind, consider). Many <strong>to verbs</strong> are about intentions, decisions, or things you want to happen (want, plan, decide, hope).</p>
            </div>

            <div class="reflection-card" style="margin-top: 1.5rem;">
                <h4>üìã Notes</h4>
                <p>Write down any verbs you find difficult to remember:</p>
                <textarea class="notes-input" placeholder="Your notes..."></textarea>
            </div>
        </section>

        <!-- Activity 2: Grammar Check -->
        <section class="section" id="activity2">
            <div class="section-header">
                <span class="section-number">Activity 2/5</span>
                <h2>Grammar Check</h2>
            </div>
            <p class="section-intro">Choose the correct form to complete each sentence.</p>

            <div class="dropdown-activity" id="dropdownActivity1">
                <div class="dropdown-sentence">
                    <span class="sentence-number">1</span>
                    <p>My role involves
                        <select class="gap-dropdown" data-answer="managing">
                            <option value="">Select...</option>
                            <option value="managing">managing</option>
                            <option value="to manage">to manage</option>
                        </select>
                        the customer service team.
                    </p>
                </div>

                <div class="dropdown-sentence">
                    <span class="sentence-number">2</span>
                    <p>I tend
                        <select class="gap-dropdown" data-answer="to be">
                            <option value="">Select...</option>
                            <option value="being">being</option>
                            <option value="to be">to be</option>
                        </select>
                        quite direct in meetings.
                    </p>
                </div>

                <div class="dropdown-sentence">
                    <span class="sentence-number">3</span>
                    <p>Would you mind
                        <select class="gap-dropdown" data-answer="sending">
                            <option value="">Select...</option>
                            <option value="sending">sending</option>
                            <option value="to send">to send</option>
                        </select>
                        me the figures?
                    </p>
                </div>

                <div class="dropdown-sentence">
                    <span class="sentence-number">4</span>
                    <p>That reminds me, I meant
                        <select class="gap-dropdown" data-answer="to ask">
                            <option value="">Select...</option>
                            <option value="asking">asking</option>
                            <option value="to ask">to ask</option>
                        </select>
                        you about the project deadline.
                    </p>
                </div>

                <div class="dropdown-sentence">
                    <span class="sentence-number">5</span>
                    <p>She stopped
                        <select class="gap-dropdown" data-answer="to check">
                            <option value="">Select...</option>
                            <option value="checking">checking</option>
                            <option value="to check">to check</option>
                        </select>
                        her phone during the presentation. <em>(= She paused in order to check it)</em>
                    </p>
                </div>
            </div>
            <button class="check-btn" onclick="checkDropdownAnswers('dropdownActivity1')">Check Answers</button>
            <button class="reset-btn" onclick="resetDropdownActivity('dropdownActivity1')">Reset</button>
            <div class="feedback" id="dropdownActivity1Feedback"></div>
        </section>

        <!-- Activity 3: Matching Expressions -->
        <section class="section" id="activity3">
            <div class="section-header">
                <span class="section-number">Activity 3/5</span>
                <h2>Expression Review: Match the Meanings</h2>
            </div>
            <p class="section-intro">Match each expression with its meaning or use. Drag the definitions to the correct expression.</p>

            <div class="drag-match-activity">
                <div class="statements-container">
                    <div class="statement-row">
                        <div class="statement-text"><strong>I'm responsible for...</strong></div>
                        <div class="drop-zone" data-match="responsible">
                            <span class="drop-placeholder">Drop here</span>
                        </div>
                    </div>
                    <div class="statement-row">
                        <div class="statement-text"><strong>My role involves...</strong></div>
                        <div class="drop-zone" data-match="involves">
                            <span class="drop-placeholder">Drop here</span>
                        </div>
                    </div>
                    <div class="statement-row">
                        <div class="statement-text"><strong>That reminds me, I meant to ask you...</strong></div>
                        <div class="drop-zone" data-match="reminds">
                            <span class="drop-placeholder">Drop here</span>
                        </div>
                    </div>
                    <div class="statement-row">
                        <div class="statement-text"><strong>I tend to...</strong></div>
                        <div class="drop-zone" data-match="tend">
                            <span class="drop-placeholder">Drop here</span>
                        </div>
                    </div>
                    <div class="statement-row">
                        <div class="statement-text"><strong>This led to...</strong></div>
                        <div class="drop-zone" data-match="ledto">
                            <span class="drop-placeholder">Drop here</span>
                        </div>
                    </div>
                    <div class="statement-row">
                        <div class="statement-text"><strong>I played a key role in...</strong></div>
                        <div class="drop-zone" data-match="keyrole">
                            <span class="drop-placeholder">Drop here</span>
                        </div>
                    </div>
                </div>

                <div class="draggable-responses" id="responseBank">
                    <div class="draggable-response" data-match="ledto" draggable="true">Showing a result or consequence</div>
                    <div class="draggable-response" data-match="responsible" draggable="true">Describing your main duties at work</div>
                    <div class="draggable-response" data-match="tend" draggable="true">Describing a habit or usual behaviour</div>
                    <div class="draggable-response" data-match="keyrole" draggable="true">Emphasising your important contribution</div>
                    <div class="draggable-response" data-match="involves" draggable="true">Describing what your job includes</div>
                    <div class="draggable-response" data-match="reminds" draggable="true">Smoothly changing the topic in conversation</div>
                </div>
            </div>
            <button class="check-btn" onclick="checkDragMatching()">Check Answers</button>
            <button class="reset-btn" onclick="resetDragMatching()">Reset</button>
            <div class="feedback" id="dragMatchingFeedback"></div>

            <div class="reveal-box" style="margin-top: 1.5rem;">
                <div class="reveal-header" onclick="toggleRevealBox(this)">
                    <h4>üìù More Expressions to Remember</h4>
                    <span class="reveal-hint">Click to reveal ‚Üí</span>
                </div>
                <div class="reveal-content">
                    <ul>
                        <li><strong>Looking back...</strong> ‚Äî Reflecting on past experiences</li>
                        <li><strong>I believe...</strong> ‚Äî Expressing your opinion professionally</li>
                        <li><strong>One of my key achievements was...</strong> ‚Äî Highlighting successes</li>
                        <li><strong>Something I'm working on improving...</strong> ‚Äî Discussing weaknesses honestly</li>
                    </ul>
                </div>
            </div>
        </section>

        <!-- Activity 4: Expressions in Practice -->
        <section class="section" id="activity4">
            <div class="section-header">
                <span class="section-number">Activity 4/5</span>
                <h2>Expressions in Practice</h2>
            </div>
            <p class="section-intro">Click each card to see an example of the expression in context.</p>

            <div class="phrase-cards">
                <div class="flip-card">
                    <div class="flip-card-inner">
                        <div class="flip-card-front">
                            <span class="phrase-label">I'm responsible for...</span>
                        </div>
                        <div class="flip-card-back">
                            <p>"I'm responsible for overseeing our digital marketing strategy and managing a budget of ‚Ç¨500,000."</p>
                        </div>
                    </div>
                </div>

                <div class="flip-card">
                    <div class="flip-card-inner">
                        <div class="flip-card-front">
                            <span class="phrase-label">I tend to...</span>
                        </div>
                        <div class="flip-card-back">
                            <p>"I tend to start my day by reviewing my priority tasks and checking emails from international clients."</p>
                        </div>
                    </div>
                </div>

                <div class="flip-card">
                    <div class="flip-card-inner">
                        <div class="flip-card-front">
                            <span class="phrase-label">This led to...</span>
                        </div>
                        <div class="flip-card-back">
                            <p>"We restructured the team and improved communication. This led to a 30% increase in productivity."</p>
                        </div>
                    </div>
                </div>

                <div class="flip-card">
                    <div class="flip-card-inner">
                        <div class="flip-card-front">
                            <span class="phrase-label">Looking back...</span>
                        </div>
                        <div class="flip-card-back">
                            <p>"Looking back, I realise that project taught me a lot about stakeholder management."</p>
                        </div>
                    </div>
                </div>

                <div class="flip-card">
                    <div class="flip-card-inner">
                        <div class="flip-card-front">
                            <span class="phrase-label">I played a key role in...</span>
                        </div>
                        <div class="flip-card-back">
                            <p>"I played a key role in launching our new product line, which generated ‚Ç¨2 million in the first quarter."</p>
                        </div>
                    </div>
                </div>

                <div class="flip-card">
                    <div class="flip-card-inner">
                        <div class="flip-card-front">
                            <span class="phrase-label">Something I'm working on...</span>
                        </div>
                        <div class="flip-card-back">
                            <p>"Something I'm working on improving is my presentation skills. I've started taking a public speaking course."</p>
                        </div>
                    </div>
                </div>
            </div>

            <div class="subsection">
                <h3>üí¨ Conversation Practice</h3>
                <p class="activity-instruction">Discuss these questions with your teacher. Try to use the target expressions.</p>

                <div class="conversation-questions">
                    <div class="question-card">
                        <div class="question-number">1</div>
                        <p>Tell me about your current job. What are you responsible for?<br><em>‚Üí Use: I'm responsible for... / My role involves...</em></p>
                    </div>
                    <div class="question-card">
                        <div class="question-number">2</div>
                        <p>What are your typical work habits? How do you usually approach tasks?<br><em>‚Üí Use: I tend to...</em></p>
                    </div>
                    <div class="question-card">
                        <div class="question-number">3</div>
                        <p>Tell me about a project or achievement you're proud of. What happened as a result?<br><em>‚Üí Use: I played a key role in... / This led to...</em></p>
                    </div>
                    <div class="question-card">
                        <div class="question-number">4</div>
                        <p>Is there anything you'd like to improve about yourself professionally?<br><em>‚Üí Use: Something I'm working on improving...</em></p>
                    </div>
                </div>
            </div>

            <div class="reflection-card" style="margin-top: 1.5rem;">
                <h4>üìã Notes</h4>
                <p>Write down any corrections or new vocabulary from the conversation:</p>
                <textarea class="notes-input" placeholder="Your notes..."></textarea>
            </div>
        </section>

        <!-- Activity 5: Wrap-up Role Play -->
        <section class="section wrap-up" id="activity5">
            <div class="section-header">
                <span class="section-number">Activity 5/5</span>
                <h2>Final Conversation: Role Play</h2>
            </div>
            <p class="section-intro">Choose one scenario and have a conversation with your teacher. Use as many expressions from today as you can.</p>

            <div class="scenario-cards">
                <div class="scenario-card" onclick="selectScenario(this)">
                    <div class="scenario-icon">ü§ù</div>
                    <h4>Networking Event</h4>
                    <p>You're at a conference and meet someone in a similar industry. Introduce yourself and discuss your jobs.</p>
                    <div class="scenario-goals">
                        <span>Target:</span> I'm responsible for, My role involves, I tend to
                    </div>
                </div>

                <div class="scenario-card" onclick="selectScenario(this)">
                    <div class="scenario-icon">üíº</div>
                    <h4>Job Interview</h4>
                    <p>You're being interviewed. The interviewer asks about your current role and a key achievement.</p>
                    <div class="scenario-goals">
                        <span>Target:</span> I played a key role in, This led to, Looking back, I believe
                    </div>
                </div>

                <div class="scenario-card" onclick="selectScenario(this)">
                    <div class="scenario-icon">‚òï</div>
                    <h4>Catching Up</h4>
                    <p>You haven't seen a colleague for a while. Chat about what you've been working on.</p>
                    <div class="scenario-goals">
                        <span>Target:</span> My role involves, That reminds me, Something I'm working on
                    </div>
                </div>
            </div>

            <div class="roleplay-tips">
                <h4>üí° Remember to:</h4>
                <ul>
                    <li>Use the target expressions naturally</li>
                    <li>Give specific examples and details</li>
                    <li>Use follow-up questions to keep the conversation going</li>
                    <li>Pay attention to verb forms (-ing vs to)</li>
                </ul>
            </div>

            <div class="reflection-grid" style="margin-top: 2rem;">
                <div class="reflection-card">
                    <h4>üåü Expressions I Used Well</h4>
                    <p>Which expressions did you use successfully today?</p>
                    <textarea class="notes-input" placeholder="Write your successes here..."></textarea>
                </div>
                <div class="reflection-card">
                    <h4>üìà Areas to Keep Practising</h4>
                    <p>Which expressions or grammar points need more practice?</p>
                    <textarea class="notes-input" placeholder="Write your goals here..."></textarea>
                </div>
            </div>
        </section>

        <!-- Lesson Completion Section -->
        <section class="section lesson-completion" id="completion">
            <div class="completion-content">
                <div class="completion-icon" id="completionIcon">üìö</div>
                <h3 id="completionTitle">You've completed Review 1!</h3>
                <p id="completionText">Great work consolidating what you've learned. Mark this review as complete when you're ready.</p>
                <div class="completion-buttons">
                    <a href="lesson3.html" class="nav-btn">‚Üê Lesson 3</a>
                    <button class="complete-lesson-btn" id="completeBtn" onclick="toggleLessonCompletion()">
                        <span class="btn-icon">‚úì</span>
                        <span class="btn-text">Mark as Complete</span>
                    </button>
                    <a href="index.html" class="nav-btn nav-btn-primary">üè† Home</a>
                </div>
            </div>
        </section>
    </main>

    <footer class="footer">
        <p>Business English Course by English in Doses</p>
    </footer>

    <script type="module" src="js/activities.js"></script>
    <script type="module" src="js/drop-down.js"></script>
    
    <script type="module">
        import { 
            isLessonComplete, 
            markLessonComplete, 
            markLessonIncomplete,
            getCurrentUser
        } from './js/lesson-utils.js';
        
        // Expose functions from activities.js to window for onclick handlers
        import('./js/activities.js').then(() => {
            // Functions are already attached to window in activities.js
        }).catch(() => {
            // Fallback if module doesn't load
            console.log('activities.js not loaded, using fallbacks');
        });
        
        // Fallback implementations if modules don't load properly
        window.checkDragMatching = window.checkDragMatching || function() {
            const feedback = document.getElementById('dragMatchingFeedback');
            const dropZones = document.querySelectorAll('.drop-zone');
            let correct = 0, total = 0, totalZones = dropZones.length;
            
            dropZones.forEach(zone => {
                const response = zone.querySelector('.draggable-response');
                if (response) {
                    total++;
                    zone.classList.remove('correct', 'incorrect');
                    response.classList.remove('correct', 'incorrect');
                    if (response.dataset.match === zone.dataset.match) {
                        zone.classList.add('correct');
                        response.classList.add('correct');
                        correct++;
                    } else {
                        zone.classList.add('incorrect');
                        response.classList.add('incorrect');
                    }
                }
            });
            
            if (feedback) {
                feedback.classList.add('show');
                if (total === 0) {
                    feedback.textContent = 'Drag responses to the drop zones first.';
                    feedback.className = 'feedback show error';
                } else if (correct === totalZones) {
                    feedback.textContent = 'Perfect! All matched correctly! üéâ';
                    feedback.className = 'feedback show success';
                } else {
                    feedback.textContent = `${correct}/${total} correct. Try again!`;
                    feedback.className = 'feedback show error';
                }
            }
        };
        
        window.resetDragMatching = window.resetDragMatching || function() {
            const feedback = document.getElementById('dragMatchingFeedback');
            const responseBank = document.getElementById('responseBank');
            const dropZones = document.querySelectorAll('.drop-zone');
            
            dropZones.forEach(zone => {
                const response = zone.querySelector('.draggable-response');
                if (response) {
                    response.classList.remove('correct', 'incorrect');
                    responseBank.appendChild(response);
                }
                zone.classList.remove('correct', 'incorrect');
                const placeholder = zone.querySelector('.drop-placeholder');
                if (placeholder) placeholder.style.display = 'block';
            });
            if (feedback) feedback.classList.remove('show');
        };
        
        window.toggleRevealBox = window.toggleRevealBox || function(header) {
            const box = header.closest('.reveal-box');
            box.classList.toggle('revealed');
        };
        
        window.selectScenario = window.selectScenario || function(card) {
            document.querySelectorAll('.scenario-card').forEach(c => c.classList.remove('selected'));
            card.classList.add('selected');
        };
        
        // Initialize drag and drop if not already done
        document.addEventListener('DOMContentLoaded', function() {
            // Flip cards
            document.querySelectorAll('.flip-card').forEach(card => {
                card.addEventListener('click', function() {
                    this.classList.toggle('flipped');
                });
            });
            
            const responseBank = document.getElementById('responseBank');
            if (!responseBank) return;
            
            let draggedResponse = null;
            
            document.querySelectorAll('.draggable-response').forEach(response => {
                response.addEventListener('dragstart', function(e) {
                    draggedResponse = this;
                    this.classList.add('dragging');
                    e.dataTransfer.effectAllowed = 'move';
                });
                response.addEventListener('dragend', function() {
                    this.classList.remove('dragging');
                    document.querySelectorAll('.drop-zone').forEach(z => z.classList.remove('drag-over'));
                });
            });
            
            document.querySelectorAll('.drop-zone').forEach(zone => {
                zone.addEventListener('dragover', function(e) {
                    e.preventDefault();
                    this.classList.add('drag-over');
                });
                zone.addEventListener('dragleave', function() {
                    this.classList.remove('drag-over');
                });
                zone.addEventListener('drop', function(e) {
                    e.preventDefault();
                    this.classList.remove('drag-over');
                    if (draggedResponse) {
                        const existing = this.querySelector('.draggable-response');
                        if (existing) responseBank.appendChild(existing);
                        const placeholder = this.querySelector('.drop-placeholder');
                        if (placeholder) placeholder.style.display = 'none';
                        this.appendChild(draggedResponse);
                        draggedResponse.classList.remove('dragging');
                    }
                });
            });
            
            responseBank.addEventListener('dragover', function(e) { e.preventDefault(); });
            responseBank.addEventListener('drop', function(e) {
                e.preventDefault();
                if (draggedResponse) {
                    this.appendChild(draggedResponse);
                    draggedResponse.classList.remove('dragging');
                    document.querySelectorAll('.drop-zone').forEach(zone => {
                        if (!zone.querySelector('.draggable-response')) {
                            const ph = zone.querySelector('.drop-placeholder');
                            if (ph) ph.style.display = 'block';
                        }
                    });
                }
            });
        });
        
        // Expose functions from drop-down.js to window for onclick handlers
        import('./js/drop-down.js').then(module => {
            window.checkDropdownAnswers = window.checkDropdownAnswers || function(activityId) {
                const activity = document.getElementById(activityId);
                if (!activity) return;
                const dropdowns = activity.querySelectorAll('.gap-dropdown');
                const feedback = document.getElementById(activityId + 'Feedback');
                let correct = 0, total = 0, answered = 0;
                
                dropdowns.forEach(dropdown => {
                    const correctAnswer = dropdown.dataset.answer;
                    const selectedValue = dropdown.value;
                    total++;
                    dropdown.classList.remove('correct', 'incorrect');
                    if (selectedValue !== '') {
                        answered++;
                        if (selectedValue === correctAnswer) {
                            dropdown.classList.add('correct');
                            correct++;
                        } else {
                            dropdown.classList.add('incorrect');
                        }
                    }
                });
                
                if (feedback) {
                    feedback.classList.add('show');
                    if (answered === 0) {
                        feedback.textContent = 'Please select answers first!';
                        feedback.className = 'feedback show error';
                    } else if (correct === total) {
                        feedback.textContent = `Excellent! All ${correct} correct! üéâ`;
                        feedback.className = 'feedback show success';
                    } else {
                        feedback.textContent = `${correct}/${total} correct. Try again!`;
                        feedback.className = 'feedback show error';
                    }
                }
            };
            
            window.resetDropdownActivity = window.resetDropdownActivity || function(activityId) {
                const activity = document.getElementById(activityId);
                if (!activity) return;
                const dropdowns = activity.querySelectorAll('.gap-dropdown');
                const feedback = document.getElementById(activityId + 'Feedback');
                dropdowns.forEach(dropdown => {
                    dropdown.value = '';
                    dropdown.classList.remove('correct', 'incorrect', 'answered');
                });
                if (feedback) {
                    feedback.classList.remove('show');
                }
            };
        });
        
        const LESSON_NUMBER = 13;
        let isComplete = false;
        
        document.addEventListener('DOMContentLoaded', async function() {
            const username = getCurrentUser();
            if (username) {
                isComplete = await isLessonComplete(LESSON_NUMBER);
                updateCompletionUI();
            }
        });
        
        function updateCompletionUI() {
            const icon = document.getElementById('completionIcon');
            const title = document.getElementById('completionTitle');
            const text = document.getElementById('completionText');
            const btn = document.getElementById('completeBtn');
            const section = document.querySelector('.lesson-completion');
            
            if (isComplete) {
                icon.textContent = 'üéâ';
                title.textContent = 'Review Complete!';
                text.textContent = 'Excellent work! You\'ve consolidated your learning from Lessons 1-3.';
                btn.innerHTML = '<span class="btn-icon">‚Ü©</span><span class="btn-text">Mark as Incomplete</span>';
                btn.classList.add('completed');
                section.classList.add('is-complete');
            } else {
                icon.textContent = 'üìö';
                title.textContent = 'You\'ve completed Review 1!';
                text.textContent = 'Great work consolidating what you\'ve learned. Mark this review as complete when you\'re ready.';
                btn.innerHTML = '<span class="btn-icon">‚úì</span><span class="btn-text">Mark as Complete</span>';
                btn.classList.remove('completed');
                section.classList.remove('is-complete');
            }
        }
        
        window.toggleLessonCompletion = async function() {
            const btn = document.getElementById('completeBtn');
            const username = getCurrentUser();
            
            if (!username) {
                alert('Please log in on the homepage first to track your progress.');
                return;
            }
            
            btn.disabled = true;
            btn.style.opacity = '0.7';
            
            try {
                if (isComplete) {
                    await markLessonIncomplete(LESSON_NUMBER);
                    isComplete = false;
                } else {
                    await markLessonComplete(LESSON_NUMBER);
                    isComplete = true;
                }
                updateCompletionUI();
            } catch (error) {
                console.error('Error toggling completion:', error);
                alert('There was an error saving your progress. Please try again.');
            } finally {
                btn.disabled = false;
                btn.style.opacity = '1';
            }
        };
    </script>
</body>
</html>
